<!doctype html>
<html lang="mn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Удвал — Зүрхэн дотор гэрэлтэх эффект + Сэтгэлийн үг</title>
  <style>
    :root{
      --bg:#0b0f14;
      --heart:#ff2d95;
      --glow: rgba(255,45,149,0.35);
      --text-color:#fff;
      --accent:#ffd6ee;
      --msg-color: #fff1f8;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: radial-gradient(1200px 600px at 10% 10%, rgba(255,45,149,0.03), transparent), radial-gradient(900px 400px at 90% 90%, rgba(45,200,255,0.02), transparent), var(--bg); color:var(--text-color); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:28px;}
    .card{width:min(920px,96vw);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:20px;padding:28px 32px;display:flex;flex-direction:column;align-items:center;gap:18px;box-shadow:0 10px 40px rgba(2,6,23,0.6);}
    .stage{width:100%;display:grid;place-items:center}
    .heart-wrap{position:relative;width:320px;height:320px;display:grid;place-items:center;transition:transform 320ms ease;}
    svg.heart{width:100%;height:100%;filter:drop-shadow(0 12px 34px rgba(255,45,149,0.16));}
    .pulse{transform-origin:50% 50%;animation:beat 1200ms infinite cubic-bezier(.25,.9,.35,1);}
    @keyframes beat{0%{transform:scale(1);}10%{transform:scale(1.06);}20%{transform:scale(0.98);}40%{transform:scale(1.03);}100%{transform:scale(1);}}

    .glow-layer{position:absolute;inset:0;border-radius:50%;pointer-events:none;filter:blur(36px);opacity:0.95}

    .center-text{position:absolute;display:flex;align-items:center;justify-content:center;inset:0;pointer-events:none;font-weight:800;font-size:42px;letter-spacing:0.02em;text-transform:none;}
    .center-text span{padding:8px 14px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));box-shadow:0 6px 26px rgba(255,45,149,0.08), inset 0 -6px 18px rgba(0,0,0,0.22);color:var(--accent);text-shadow:0 0 18px rgba(255,45,149,0.85), 0 0 36px rgba(255,200,230,0.45);animation:glowText 2.6s ease-in-out infinite;transform-origin:center;}
    @keyframes glowText{0%{transform:translateY(0) scale(1);}40%{transform:translateY(-4px) scale(1.02);}70%{transform:translateY(0) scale(1);}100%{transform:translateY(0) scale(1);} }

    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:center}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:10px;color:var(--accent);cursor:pointer;font-weight:600}
    .small{font-size:13px;padding:8px 12px}

    /* message area */
    .message-wrap{width:100%;max-width:820px;padding:18px 20px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.035);box-shadow:inset 0 -8px 24px rgba(0,0,0,0.25);}
    .input-row{display:flex;gap:10px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    textarea#msgInput{flex:1;min-height:64px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text-color);resize:vertical;font-size:15px}
    label{font-size:13px;color:rgba(255,255,255,0.7);white-space:nowrap}

    .preview{min-height:64px;display:flex;align-items:center;flex-wrap:wrap;gap:6px;padding:6px 8px}
    .char{opacity:0;transform:translateY(8px) scale(0.98);display:inline-block;font-weight:700;font-size:20px;color:var(--msg-color);text-shadow:0 0 10px rgba(255,45,149,0.45);transition:transform 260ms cubic-bezier(.2,.9,.3,1), opacity 260ms ease;}
    .char.visible{opacity:1;transform:translateY(0) scale(1)}

    .action-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:12px}
    .status{font-size:13px;color:rgba(255,255,255,0.7);min-height:20px}

    @media (max-width:520px){.center-text{font-size:28px}.heart-wrap{width:260px;height:260px}.card{padding:18px} .char{font-size:16px} textarea#msgInput{min-height:56px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="stage">
        <div class="heart-wrap" id="heartWrap">
          <svg class="heart" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0%" stop-color="#ff6fb1"/>
                <stop offset="100%" stop-color="#ff2d95"/>
              </linearGradient>
            </defs>
            <g class="pulse" id="pulseGroup">
              <path d="M100 30 C130 0 180 25 160 70 C140 110 100 140 100 140 C100 140 60 110 40 70 C20 25 70 0 100 30 Z" fill="url(#g1)" opacity="0.16"/>
              <path d="M100 36 C128 8 172 28 155 68 C137 106 100 132 100 132 C100 132 63 106 45 68 C28 28 72 8 100 36 Z" fill="url(#g1)" opacity="0.28"/>
              <path id="mainHeart" d="M100 42 C124 18 164 36 150 74 C134 112 100 136 100 136 C100 136 66 112 50 74 C36 36 76 18 100 42 Z" fill="#ff2d95"/>
            </g>
          </svg>
          <div class="glow-layer" style="background: radial-gradient(60% 50% at 50% 35%, var(--glow), transparent 40%);"></div>
          <div class="center-text"><span id="udval">Удвал</span></div>
        </div>
      </div>

      <div class="message-wrap">
        <div class="input-row">
          <label for="msgInput">Сэтгэлийн үг:</label>
          <textarea id="msgInput">Би чам руу 100 алхахад — чи над руу 1 алхам хийж чадах уу?</textarea>
          <div style="display:flex;flex-direction:column;gap:6px;min-width:150px">
            <div style="display:flex;gap:6px">
              <button class="btn small" id="playBtn">Гаргах</button>
              <button class="btn small" id="clearBtn">Арилгах</button>
            </div>
            <label>Хурд: <span id="speedVal">60</span> мс/үсэг</label>
            <input id="speed" type="range" min="20" max="200" value="60"/>
          </div>
        </div>

        <div class="preview" id="preview"></div>

        <div class="action-row">
          <button class="btn small" id="yesBtn">Тийм </button>
          <button class="btn small" id="noBtn">Үгүй</button>
          <button class="btn small" id="copyBtn">Текст хуулж авах</button>
          <div class="status" id="status"></div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const preview = document.getElementById('preview');
    const msgInput = document.getElementById('msgInput');
    const speedRange = document.getElementById('speed');
    const speedVal = document.getElementById('speedVal');
    const playBtn = document.getElementById('playBtn');
    const clearBtn = document.getElementById('clearBtn');
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const copyBtn = document.getElementById('copyBtn');
    const status = document.getElementById('status');
    const heartWrap = document.getElementById('heartWrap');
    let typingTimer = null;

    speedRange.addEventListener('input', ()=> speedVal.textContent = speedRange.value);

    function clearPreview(){
      preview.innerHTML = '';
      if(typingTimer){ clearInterval(typingTimer); typingTimer = null; }
    }

    function showMessageLetters(text, msPerChar){
      clearPreview();
      const chars = Array.from(text);
      chars.forEach((ch)=>{
        const span = document.createElement('span');
        span.className = 'char';
        if(ch === ' ') span.innerHTML = '&nbsp;';
        else if(ch === '\n') span.innerHTML = '<br/>';
        else span.textContent = ch;
        preview.appendChild(span);
      });
      const nodes = Array.from(preview.querySelectorAll('.char'));
      let i=0;
      typingTimer = setInterval(()=>{
        if(i>=nodes.length){ clearInterval(typingTimer); typingTimer=null; return; }
        const el = nodes[i];
        requestAnimationFrame(()=> el.classList.add('visible'));
        i++;
      }, Math.max(8, parseInt(msPerChar,10)));
    }

    playBtn.addEventListener('click', ()=> showMessageLetters(msgInput.value, speedRange.value));
    clearBtn.addEventListener('click', clearPreview);

    copyBtn.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(msgInput.value);
        status.textContent='Текст хуулсан ✔';
        setTimeout(()=>status.textContent='',1600);
      }catch(e){status.textContent='Хуулалт амжилтгүй';}
    });

    // Тийм товч: сервер рүү POST илгээх
    yesBtn.addEventListener('click', async ()=>{
      heartWrap.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(0.98)'},{transform:'scale(1)'}],{duration:550,easing:'cubic-bezier(.2,.9,.3,1)'});
      const recipient='orgiloorgil16@gmail.com';
      const subject='Хариулт: Би тийм гэж бодож байна';
      const body=msgInput.value;

      try{
const response = await fetch('/send-email', {
  method:'POST',
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({recipient, subject, body})
});

        const result = await response.json();
        if(result.success) status.textContent='Имэйл амжилттай илгээгдлээ ✔';
        else status.textContent='Алдаа гарлаа: '+result.error;
      }catch(e){status.textContent='Сервер холбогдсонгүй: '+e.message;}
      setTimeout(()=>status.textContent='',3000);
    });

    noBtn.addEventListener('click', ()=>{
      status.textContent='Таны сонголт хадгалагдлаа.';
      heartWrap.animate([{transform:'translateY(0) rotate(0deg)'},{transform:'translateY(-8px) rotate(-4deg)'},{transform:'translateY(0) rotate(0deg)'}],{duration:520,easing:'ease-out'});
      setTimeout(()=>status.textContent='',1600);
    });

    window.addEventListener('load', ()=> showMessageLetters(msgInput.value, speedRange.value));
    msgInput.addEventListener('keydown',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key==='Enter') playBtn.click(); });
  </script>
</body>
</html>
